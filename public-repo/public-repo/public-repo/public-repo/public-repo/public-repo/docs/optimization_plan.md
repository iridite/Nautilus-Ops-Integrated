# Keltner RS Breakout 策略参数优化方案

**生成时间**: 2026-02-25
**设计者**: optimizer
**基于分析**: analyst 基线性能分析

## 一、优化目标

基于当前基线性能（2022-2026，4年回测）：

| 指标 | 当前值 | 目标值 | 提升幅度 |
|------|--------|--------|----------|
| 交易频率 | 55 笔/年 | 150 笔/年 | +173% (2.7x) |
| 胜率 | 41% | 48% | +7pp |
| 盈亏比 | 1.68 | 1.85 | +10% |
| Sharpe Ratio | 0.67 | 1.0+ | +49% |
| 总收益 | 18.97% | 30%+ | +58% |

## 二、参数优化方案

### 阶段 1: 核心参数优化（优先级：⭐⭐⭐）

#### 1.1 keltner_trigger_multiplier
**影响维度**: 交易频率

- **当前值**: 2.8
- **测试范围**: [2.0, 2.2, 2.4, 2.6, 2.8]
- **步长**: 0.2
- **测试数量**: 5 组
- **预期效果**:
  - 降低阈值 → 更容易触发突破信号
  - 增加入场机会 → 提升交易频率
  - 风险：可能增加假突破

#### 1.2 stop_loss_atr_multiplier
**影响维度**: 盈亏比

- **当前值**: 2.6
- **测试范围**: [2.2, 2.4, 2.6, 2.8, 3.0]
- **步长**: 0.2
- **测试数量**: 5 组
- **预期效果**:
  - 较小值 → 止损更紧 → 减少单笔亏损
  - 较大值 → 止损更宽 → 给趋势更多空间
  - 需要平衡：过紧易被震出，过宽亏损大

#### 1.3 base_risk_pct + high_conviction_risk_pct
**影响维度**: 风险收益比

- **当前值**: 0.01 / 0.015 (1% / 1.5%)
- **测试范围**:
  - base_risk_pct: [0.008, 0.010, 0.012]
  - high_conviction_risk_pct: [0.012, 0.015, 0.018]
- **测试数量**: 3 × 3 = 9 组
- **预期效果**:
  - 提高风险 → 增加仓位 → 提升收益（但也增加回撤）
  - 需要保持 high/base 比例约 1.5x

**阶段 1 小计**: 5 + 5 + 9 = **19 组测试**

---

### 阶段 2: 次要参数优化（优先级：⭐⭐）

#### 2.1 deviation_threshold
**影响维度**: 止盈时机、盈亏比

- **当前值**: 0.45
- **测试范围**: [0.35, 0.40, 0.45, 0.50, 0.55]
- **步长**: 0.05
- **测试数量**: 5 组
- **预期效果**:
  - 提高阈值 → 保本止损触发更晚
  - 让利润充分奔跑 → 提升盈亏比
  - 风险：可能回吐更多利润

#### 2.2 volume_multiplier
**影响维度**: 胜率、信号质量

- **当前值**: 2.0
- **测试范围**: [1.5, 1.8, 2.0, 2.2, 2.5]
- **步长**: 0.2-0.3
- **测试数量**: 5 组
- **预期效果**:
  - 降低阈值 → 更多信号通过 → 增加交易频率
  - 提高阈值 → 更严格过滤 → 提升胜率
  - 需要平衡：频率 vs 质量

#### 2.3 breakeven_multiplier
**影响维度**: 风控、盈亏比

- **当前值**: 2.0
- **测试范围**: [1.5, 2.0, 2.5, 3.0]
- **步长**: 0.5
- **测试数量**: 4 组
- **预期效果**:
  - 较小值 → 更早触发保本止损 → 保护利润
  - 较大值 → 给趋势更多空间 → 提升盈亏比

**阶段 2 小计**: 5 + 5 + 4 = **14 组测试**

---

### 阶段 3: 组合优化（优先级：⭐）

基于阶段 1 和 2 的最优参数，进行组合验证：

#### 3.1 核心参数组合
- 最优 keltner_trigger_multiplier × 最优 stop_loss_atr_multiplier
- 测试数量: 4 组（最优值 ± 1 步长）

#### 3.2 交叉验证
- 最优 deviation_threshold × 最优 volume_multiplier
- 测试数量: 4 组

#### 3.3 全局最优验证
- 所有最优参数组合
- 测试数量: 3-5 组（微调）

**阶段 3 小计**: 约 **10-15 组测试**

---

## 三、优化策略

### 方法选择
**分阶段网格搜索** (Staged Grid Search)

**优点**:
- 避免组合爆炸（全组合需要 5×5×9×5×5×4 = 22,500 组）
- 每个阶段独立分析，便于理解参数影响
- 可以提前终止（如果某阶段效果不佳）

**缺点**:
- 可能错过全局最优（但概率较低）
- 需要人工判断阶段间的最优参数

### 执行流程

```
阶段 1: 核心参数优化 (19 组)
    ↓
分析结果 → 选出最优参数
    ↓
阶段 2: 次要参数优化 (14 组)
    ↓
分析结果 → 选出最优参数
    ↓
阶段 3: 组合验证 (10-15 组)
    ↓
最终最优参数
```

### 技术实现

使用现有的 `scripts/optimize_parameters.py` 脚本：

```bash
# 阶段 1
uv run python scripts/optimize_parameters.py --stage 1

# 阶段 2
uv run python scripts/optimize_parameters.py --stage 2

# 阶段 3
uv run python scripts/optimize_parameters.py --stage 3
```

**注意**: 需要修改脚本以适配 Keltner RS Breakout 策略参数

---

## 四、时间预估

### 单次回测耗时
- 数据加载: ~10s
- 策略执行: ~100s
- 结果保存: ~10s
- **总计**: ~120s (2 分钟)

### 总耗时预估

| 阶段 | 测试数量 | 单次耗时 | 总耗时 |
|------|----------|----------|--------|
| 阶段 1 | 19 组 | 2 分钟 | 38 分钟 |
| 阶段 2 | 14 组 | 2 分钟 | 28 分钟 |
| 阶段 3 | 15 组 | 2 分钟 | 30 分钟 |
| **总计** | **48 组** | - | **96 分钟 (1.6 小时)** |

**备注**:
- 串行执行（避免资源竞争）
- 如果使用并行（4 进程），可缩短至 ~25 分钟

---

## 五、评估指标

### 主要指标
1. **Sharpe Ratio** (主要优化目标)
2. **交易次数** (需达到 150 笔/年)
3. **胜率** (目标 48%)
4. **盈亏比** (目标 1.85)

### 次要指标
5. 总收益率 (PnL%)
6. 最大回撤 (Max Drawdown)
7. Sortino Ratio
8. Profit Factor
9. 平均盈利 / 平均亏损
10. 最大连续亏损

### 记录格式

每组测试保存为 CSV，包含：

```csv
keltner_trigger_multiplier,stop_loss_atr_multiplier,base_risk_pct,high_conviction_risk_pct,deviation_threshold,volume_multiplier,breakeven_multiplier,sharpe_ratio,total_trades,win_rate,profit_loss_ratio,total_pnl,max_drawdown,status
2.0,2.6,0.01,0.015,0.45,2.0,2.0,0.85,180,0.43,1.75,25.3,0.15,success
...
```

---

## 六、风险控制

### 6.1 过拟合风险

**问题**: 参数在历史数据上表现好，但未来表现差

**解决方案**:
1. **样本内/样本外验证**
   - 训练集: 2022-01-01 至 2024-12-31 (3年)
   - 验证集: 2025-01-01 至 2026-01-01 (1年)
   - 要求: 验证集 Sharpe ≥ 训练集 Sharpe × 0.8

2. **Walk-Forward 分析**
   - 滚动窗口: 每年重新优化参数
   - 检查参数稳定性

3. **参数敏感度分析**
   - 检查最优参数 ± 10% 的表现
   - 要求: 性能下降 < 20%

### 6.2 鲁棒性检验

**方法**:
1. **参数热力图**: 可视化参数空间
2. **稳定性分析**: 检查参数是否在"平台区"（而非"尖峰"）
3. **多市场验证**: 在不同市场周期测试

### 6.3 实战可行性

**检查项**:
1. 交易频率合理（不过度交易）
2. 单笔风险可控（< 2%）
3. 最大回撤可接受（< 30%）
4. 连续亏损次数合理（< 10 次）

---

## 七、预期结果

### 乐观情景（90% 置信度）
- Sharpe Ratio: 0.67 → 1.0+ (+49%)
- 交易频率: 55 → 120 笔/年 (+118%)
- 胜率: 41% → 45% (+4pp)
- 盈亏比: 1.68 → 1.80 (+7%)

### 保守情景（95% 置信度）
- Sharpe Ratio: 0.67 → 0.85 (+27%)
- 交易频率: 55 → 90 笔/年 (+64%)
- 胜率: 41% → 43% (+2pp)
- 盈亏比: 1.68 → 1.75 (+4%)

### 失败情景
- 所有参数组合均无显著改善
- 建议: 考虑策略逻辑层面的优化（而非参数调整）

---

## 八、后续行动

### 优化完成后
1. **生成分析报告**: 参数敏感度、鲁棒性分析
2. **更新配置文件**: 应用最优参数
3. **实盘前验证**:
   - 最近 3 个月数据回测
   - 模拟盘测试 1-2 周
4. **监控指标**: 设置预警阈值

### 持续优化
- 每季度重新评估参数
- 根据市场变化调整
- 记录优化历史，建立参数数据库

---

## 附录

### A. 参数说明

| 参数名 | 含义 | 当前值 | 单位 |
|--------|------|--------|------|
| keltner_trigger_multiplier | Keltner 通道触发倍数 | 2.8 | 倍 |
| stop_loss_atr_multiplier | ATR 止损倍数 | 2.6 | 倍 |
| base_risk_pct | 基础风险百分比 | 0.01 | % |
| high_conviction_risk_pct | 高确信度风险百分比 | 0.015 | % |
| deviation_threshold | 偏离阈值（保本止损） | 0.45 | - |
| volume_multiplier | 成交量倍数 | 2.0 | 倍 |
| breakeven_multiplier | 保本止损倍数 | 2.0 | 倍 |

### B. 参考资料

- 策略代码: `strategy/keltner_rs_breakout.py`
- 配置文件: `config/strategies/keltner_rs_breakout.yaml`
- 优化脚本: `scripts/optimize_parameters.py`
- 基线分析: analyst 报告（任务 #1）

---

**文档版本**: v1.0
**最后更新**: 2026-02-25
