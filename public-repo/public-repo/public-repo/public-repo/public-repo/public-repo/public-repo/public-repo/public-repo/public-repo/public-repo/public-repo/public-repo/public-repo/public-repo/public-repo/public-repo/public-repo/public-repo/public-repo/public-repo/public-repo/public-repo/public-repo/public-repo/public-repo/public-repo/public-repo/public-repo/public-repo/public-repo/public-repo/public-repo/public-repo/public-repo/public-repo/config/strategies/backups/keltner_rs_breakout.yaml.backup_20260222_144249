# Keltner RS Breakout 策略配置
# Keltner RS Breakout - 中低频趋势跟踪策略

name: "KeltnerRSBreakoutStrategy"
module_path: "strategy.keltner_rs_breakout"
config_class: "KeltnerRSBreakoutConfig"

# 策略参数
parameters:
  # 多币种配置（策略负责交易对象）
  symbols: ["ETHUSDT", "SOLUSDT", "BNBUSDT", "DOGEUSDT"]
  timeframe: "1d"
  price_type: "LAST"
  origination: "EXTERNAL"
  btc_symbol: "BTCUSDT"

  # 时间框架依赖
  timeframes: ["main"]

  # 数据依赖声明
  data_types: ["funding"]

  # 指标参数
  ema_period: 20
  atr_period: 20
  sma_period: 200
  bb_period: 20
  bb_std: 2.5  # 修复：从 1.5 → 2.5（激进放宽）
  volume_period: 20

  # 通道参数
  keltner_base_multiplier: 1.5
  keltner_trigger_multiplier: 2.0  # 修复：从 2.8 → 2.0（激进放宽）

  # 风控参数
  base_risk_pct: 0.01
  high_conviction_risk_pct: 0.015
  stop_loss_atr_multiplier: 3.5  # 修复：从 2.6 → 3.5（激进放宽）
  enable_time_stop: false
  time_stop_bars: 3
  time_stop_momentum_threshold: 0.01
  breakeven_multiplier: 2.0
  # 只有当浮盈已经很厚（比如赚了 5% - 8%）时，才把 breakeven 止损激活。这时候价格通常已经脱离了成本区，回踩也很难踩到你的开仓价了。
  deviation_threshold: 0.45
  enable_rsi_stop_loss: false # RSI 止损
  max_upper_wick_ratio: 0.3

  # 过滤器参数
  volume_multiplier: 1.2  # 修复：从 2.0 → 1.2（激进放宽）
  rs_short_lookback_days: 5
  rs_long_lookback_days: 20
  rs_short_weight: 0.7
  rs_long_weight: 0.3
  squeeze_memory_days: 1

  # BTC 市场状态过滤器参数
  enable_btc_regime_filter: false  # 修复：禁用（最关键）
  btc_regime_sma_period: 200
  btc_regime_atr_period: 14
  btc_max_atr_pct: 0.03

  # 市场狂热度过滤器参数（基于 Funding Rate）
  enable_euphoria_filter: false
  funding_rate_warning_annual: 100.0 # 年化资金费率警告阈值（%）
  funding_rate_danger_annual: 200.0 # 年化资金费率危险阈值（%）
  euphoria_reduce_position_pct: 0.5 # 危险状态下的减仓比例（减仓50%，保留50%）

  # Universe 参数
  universe_top_n: 15
  universe_freq: W-MON # Universe 更新周期（ME=月度, W-MON=周度, 2W-MON=双周）

  # 最大持仓数量限制
  # 说明（根据 oms_type 不同而不同）：
  #
  # HEDGING 模式（当前配置）：
  # - 支持对同一币对开多个仓位（多空独立）
  # - max_positions 限制所有币对的总持仓数
  # - 例如：max_positions=10 可以是 ETH 3个 + SOL 2个 + BNB 3个 + DOGE 2个
  # - 每个持仓独立管理止损
  #
  # NETTING 模式（如需切换）：
  # - 每个币对最多1个仓位（多空会合并）
  # - max_positions 限制不同币对的数量
  # - 例如：4个标的最多持有4个仓位
  # - 建议设置为 symbols 列表长度
  #
  # 我们采用的是 Hold until stop 模式，理论上拥有一个无限大的缓冲区，只要 inactive 的币对不触发任何的止损机制那么策略就不会主动发起平仓
  max_positions: 5

  # 仓位管理
  # 推荐使用 ATR 风险模式（注释掉 qty_percent）
  # TODO: ATR 风险模式怎么缺少了对应的参数？
  #
  # ATR 模式根据波动率动态调整仓位，回测收益提升约 5 倍（+61.78% vs +10.34%）
  # 固定百分比模式（qty_percent: 0.1）收益较低但更保守
  # qty_percent: 0.1
  leverage: 1
