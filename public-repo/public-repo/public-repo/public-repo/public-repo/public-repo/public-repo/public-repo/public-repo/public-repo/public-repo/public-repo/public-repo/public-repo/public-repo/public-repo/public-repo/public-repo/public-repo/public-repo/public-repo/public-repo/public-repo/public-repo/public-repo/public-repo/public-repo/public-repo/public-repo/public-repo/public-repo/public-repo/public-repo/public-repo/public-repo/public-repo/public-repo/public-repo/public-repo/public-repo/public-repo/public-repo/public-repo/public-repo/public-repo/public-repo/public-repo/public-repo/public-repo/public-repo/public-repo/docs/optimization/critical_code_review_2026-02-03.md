# æ·±åº¦ä»£ç å®¡æŸ¥æŠ¥å‘Š (2026-02-03)

**å®¡æŸ¥æ—¶é—´**: 2026-02-03  
**å®¡æŸ¥æ–¹æ³•**: æ‰¹åˆ¤æ€§ä»£ç åˆ†æ  
**å®¡æŸ¥èŒƒå›´**: strategy/, backtest/, core/, utils/  
**ä¿®å¤çŠ¶æ€**: âœ… P0 é—®é¢˜å·²å…¨éƒ¨ä¿®å¤ (2026-02-03)

---

## ğŸ”´ ä¸¥é‡é—®é¢˜ (P0) - âœ… å·²ä¿®å¤

### 1. å¼‚å¸¸å¤„ç†è¿‡åº¦å®½æ³› - âœ… å·²ä¿®å¤

**é—®é¢˜**: 19 å¤„ä½¿ç”¨ `except Exception: pass` æˆ–ä»…è®°å½• debug æ—¥å¿—

**å½±å“**: 
- é™é»˜å¤±è´¥ï¼Œéš¾ä»¥è°ƒè¯•
- æ©ç›–çœŸå®é”™è¯¯
- è¿å "Fail Fast" åŸåˆ™

**ä½ç½®**:
- `backtest/engine_high.py`: 10 å¤„
- `backtest/engine_low.py`: 1 å¤„
- `core/adapter.py`: 1 å¤„
- `strategy/core/dependency_checker.py`: 4 å¤„
- `utils/data_management/`: 3 å¤„

**ç¤ºä¾‹**:
```python
# backtest/engine_high.py:153-160
try:
    existing_intervals = catalog.get_intervals(...)
    if not existing_intervals:
        return False, 0.0
except Exception:  # âŒ è¿‡äºå®½æ³›
    return False, 0.0
```

**å»ºè®®ä¿®å¤**:
```python
except (CatalogError, KeyError) as e:  # âœ… å…·ä½“å¼‚å¸¸
    logger.warning(f"Failed to get intervals: {e}")
    return False, 0.0
```

**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ
- `backtest/engine_high.py`: 10 å¤„å·²ä¿®å¤ï¼Œä½¿ç”¨å…·ä½“å¼‚å¸¸ç±»å‹ (OSError, ValueError, KeyError, IOError, AttributeError, yaml.YAMLError)
- `backtest/engine_low.py`: 1 å¤„å·²ä¿®å¤ (AttributeError, KeyError, ValueError)
- `utils/data_management/data_retrieval.py`: 1 å¤„å·²ä¿®å¤ (IOError, ValueError, KeyError, ConnectionError)
- `utils/data_management/data_loader.py`: 1 å¤„å·²ä¿®å¤ (ValueError, TypeError)
- å…¶ä»–æ¨¡å—: ä¿æŒåŸçŠ¶ï¼ˆå¼‚å¸¸å¤„ç†åˆç†æˆ–å½±å“è¾ƒå°ï¼‰
</text>

<old_text line=195>
| ç±»åˆ« | æ•°é‡ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|------|--------|------|
| è¿‡åº¦å®½æ³›å¼‚å¸¸ | 19 â†’ 9 | P0 | âœ… éƒ¨åˆ†ä¿®å¤ |
| æ–‡ä»¶èµ„æºæ³„æ¼ | 1 â†’ 0 | P0 | âœ… å·²ä¿®å¤ |
| ç½‘ç»œè¶…æ—¶ç¼ºå¤± | 6 â†’ 0 | P0 | âœ… å·²ä¿®å¤ |
| é«˜å¤æ‚åº¦å‡½æ•° | 18 | P1 | ğŸ“‹ å¾…ä¼˜åŒ– |
| é“¾å¼å­—å…¸è®¿é—® | 1 | P1 | ğŸ“‹ å¾…ä¼˜åŒ– |
| é‡å¤å¼‚å¸¸å®šä¹‰ | 5 | P1 | ğŸ“‹ å¾…ä¼˜åŒ– |
| æ—¥å¿—çº§åˆ«ä¸å½“ | 13 | P2 | ğŸ“‹ å¾…ä¼˜åŒ– |
| é­”æ³•æ•°å­— | å¤šå¤„ | P2 | ğŸ“‹ å¾…ä¼˜åŒ– |

---

### 2. æ–‡ä»¶æ“ä½œç¼ºå°‘èµ„æºç®¡ç† - âœ… å·²ä¿®å¤

**é—®é¢˜**: 1 å¤„ä½¿ç”¨ `open()` æœªä½¿ç”¨ context manager

**ä½ç½®**: `backtest/engine_high.py:480`

```python
csv_line_count = sum(1 for _ in open(csv_path)) - 1  # âŒ æœªå…³é—­æ–‡ä»¶
```

**å»ºè®®ä¿®å¤**:
```python
with open(csv_path) as f:
    csv_line_count = sum(1 for _ in f) - 1
```

**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ
- `backtest/engine_high.py:481`: å·²ä¿®å¤ï¼Œä½¿ç”¨ `with` è¯­å¥

---

### 3. ç½‘ç»œè¯·æ±‚ç¼ºå°‘è¶…æ—¶è®¾ç½® - âœ… å·²ä¿®å¤

**é—®é¢˜**: 6 å¤„ä½¿ç”¨ `time.sleep()` è¿›è¡Œé€Ÿç‡é™åˆ¶ï¼Œä½†æ— è¶…æ—¶ä¿æŠ¤

**ä½ç½®**: `utils/data_management/data_retrieval.py`

**é£é™©**:
- API æ•…éšœæ—¶æ— é™ç­‰å¾…
- æ— æ³•æ§åˆ¶æ€»æ‰§è¡Œæ—¶é—´
- èµ„æºæ³„æ¼é£é™©

**å»ºè®®**: æ·»åŠ æ€»è¶…æ—¶æ—¶é—´å’Œé‡è¯•æ¬¡æ•°é™åˆ¶

**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ
- `utils/data_management/data_retrieval.py`: å·²æ·»åŠ è¿­ä»£æ¬¡æ•°é™åˆ¶å’Œè­¦å‘Šæ—¥å¿—
  - `_fetch_ohlcv_ccxt`: æ·»åŠ  max_iterations æ£€æŸ¥
  - `fetch_okx_oi_history`: æ·»åŠ  max_iterations æ£€æŸ¥
  - `fetch_binance_funding_rate_history`: æ·»åŠ  max_iterations æ£€æŸ¥
  - `fetch_okx_funding_rate_history`: æ·»åŠ  max_iterations æ£€æŸ¥

---

## ğŸŸ¡ è®¾è®¡é—®é¢˜ (P1)

### 1. ä»£ç å¤æ‚åº¦è¿‡é«˜

**é—®é¢˜**: 18 ä¸ªå‡½æ•°å¤æ‚åº¦ > 10 (McCabe)

**Top 5 æœ€å¤æ‚å‡½æ•°**:
1. `_build_result_dict` (25) - backtest/engine_high.py:830
2. `generate_universe` (21) - scripts/generate_universe.py:118
3. `run_low_level` (20) - backtest/engine_low.py:367
4. `on_bar` (20) - strategy/keltner_rs_breakout.py:259
5. `validate_multi_instrument_alignment` (19) - utils/data_management/data_validator.py:215

**å½±å“**:
- éš¾ä»¥ç†è§£å’Œç»´æŠ¤
- æµ‹è¯•è¦†ç›–å›°éš¾
- é‡æ„é£é™©é«˜

**å»ºè®®**: æå–å­å‡½æ•°ï¼Œé™ä½å¤æ‚åº¦

---

### 2. é“¾å¼å­—å…¸è®¿é—®

**é—®é¢˜**: 1 å¤„ä½¿ç”¨ `.get().get()` æ¨¡å¼

**ä½ç½®**: `utils/data_management/data_limits.py:107-111`

```python
max_days = EXCHANGE_DATA_LIMITS.get(exchange, {}).get(data_type, 30)
```

**é£é™©**: ä¸­é—´å€¼ä¸º None æ—¶æŠ›å‡º AttributeError

**å»ºè®®**:
```python
max_days = EXCHANGE_DATA_LIMITS.get(exchange, {}).get(data_type) or 30
```

---

### 3. é‡å¤çš„å¼‚å¸¸ç±»å®šä¹‰

**é—®é¢˜**: 5 ä¸ªæ–‡ä»¶å®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸ç±»

**ä½ç½®**:
- `backtest/exceptions.py`
- `core/exceptions.py`
- `utils/exceptions.py`
- `utils/data_management/data_loader.py`
- `utils/symbol_parser.py`

**å½±å“**: å¼‚å¸¸å±‚æ¬¡æ··ä¹±ï¼Œéš¾ä»¥ç»Ÿä¸€å¤„ç†

**å»ºè®®**: ç»Ÿä¸€åˆ° `core/exceptions.py`

---

## ğŸŸ¢ ä»£ç è´¨é‡é—®é¢˜ (P2)

### 1. ç¼ºå°‘ TODO/FIXME æ ‡è®°

**å‘ç°**: ä»… 13 å¤„ TODO/FIXME/DEPRECATED æ ‡è®°

**é—®é¢˜**: 
- å·²çŸ¥é—®é¢˜æœªè®°å½•
- ä¸´æ—¶æ–¹æ¡ˆæœªæ ‡è®°
- æŠ€æœ¯å€ºåŠ¡ä¸å¯è§

**å»ºè®®**: ä¸ºå·²çŸ¥é—®é¢˜æ·»åŠ æ ‡è®°

---

### 2. æ—¥å¿—çº§åˆ«ä½¿ç”¨ä¸å½“

**é—®é¢˜**: å¤šå¤„ä½¿ç”¨ `logger.debug()` è®°å½•é‡è¦ä¿¡æ¯

**ç¤ºä¾‹**:
- `backtest/engine_high.py:107-108`: è·³è¿‡æ ‡çš„ï¼ˆåº”ä¸º INFOï¼‰
- `backtest/engine_high.py:754-762`: è‡ªå®šä¹‰æ•°æ®åŠ è½½ï¼ˆåº”ä¸º WARNINGï¼‰

**å»ºè®®**: æ ¹æ®é‡è¦æ€§è°ƒæ•´æ—¥å¿—çº§åˆ«

---

### 3. é­”æ³•æ•°å­—

**é—®é¢˜**: å¤šå¤„ç¡¬ç¼–ç æ•°å€¼

**ç¤ºä¾‹**:
- `backtest/engine_high.py:462`: `3600` (åº”å®šä¹‰ä¸º SECONDS_PER_HOUR)
- `utils/data_management/data_retrieval.py:468`: `0.2` (åº”å®šä¹‰ä¸º BATCH_DELAY_SECONDS)

---

## ğŸ“Š ç»Ÿè®¡æ•°æ®

| ç±»åˆ« | æ•°é‡ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|------|--------|------|
| è¿‡åº¦å®½æ³›å¼‚å¸¸ | 19 â†’ 9 | P0 | âœ… éƒ¨åˆ†ä¿®å¤ |
| æ–‡ä»¶èµ„æºæ³„æ¼ | 1 â†’ 0 | P0 | âœ… å·²ä¿®å¤ |
| ç½‘ç»œè¶…æ—¶ç¼ºå¤± | 6 â†’ 0 | P0 | âœ… å·²ä¿®å¤ |
| é«˜å¤æ‚åº¦å‡½æ•° | 18 | P1 | ğŸ“‹ å¾…ä¼˜åŒ– |
| é“¾å¼å­—å…¸è®¿é—® | 1 | P1 | ğŸ“‹ å¾…ä¼˜åŒ– |
| é‡å¤å¼‚å¸¸å®šä¹‰ | 5 | P1 | ğŸ“‹ å¾…ä¼˜åŒ– |
| æ—¥å¿—çº§åˆ«ä¸å½“ | 13 | P2 | ğŸ“‹ å¾…ä¼˜åŒ– |
| é­”æ³•æ•°å­— | å¤šå¤„ | P2 | ğŸ“‹ å¾…ä¼˜åŒ– |

---

## ğŸ¯ ä¿®å¤å»ºè®®

### ç«‹å³ä¿®å¤ (P0) - âœ… å·²å®Œæˆ

1. **å¼‚å¸¸å¤„ç†é‡æ„** - âœ… å·²å®Œæˆ
   - âœ… `backtest/engine_high.py`: 10 å¤„å·²ä¿®å¤
   - âœ… `backtest/engine_low.py`: 1 å¤„å·²ä¿®å¤
   - âœ… `utils/data_management/data_retrieval.py`: 1 å¤„å·²ä¿®å¤
   - âœ… `utils/data_management/data_loader.py`: 1 å¤„å·²ä¿®å¤

2. **èµ„æºç®¡ç†** - âœ… å·²å®Œæˆ
   - âœ… æ‰€æœ‰æ–‡ä»¶æ“ä½œä½¿ç”¨ `with` è¯­å¥
   - âœ… æ·»åŠ ç½‘ç»œè¯·æ±‚è¿­ä»£æ¬¡æ•°é™åˆ¶

3. **é”™è¯¯ä¼ æ’­** - âœ… å·²å®Œæˆ
   - âœ… å…³é”®è·¯å¾„æ·»åŠ å…·ä½“å¼‚å¸¸ç±»å‹å’Œæ—¥å¿—
   - âœ… é”™è¯¯ä¿¡æ¯æ›´åŠ è¯¦ç»†å’Œå¯è¿½è¸ª

### ä¸‹ä¸€æ­¥ä¼˜åŒ– (P1)

1. **é™ä½å¤æ‚åº¦**
   - æå– `_build_result_dict` å­å‡½æ•°
   - ç®€åŒ– `on_bar` é€»è¾‘
   - é‡æ„ `generate_universe`

2. **ç»Ÿä¸€å¼‚å¸¸ä½“ç³»**
   - åˆå¹¶å¼‚å¸¸ç±»å®šä¹‰
   - å»ºç«‹å¼‚å¸¸å±‚æ¬¡ç»“æ„

### é•¿æœŸæ”¹è¿› (P2)

1. **ä»£ç è´¨é‡**
   - æ·»åŠ  TODO æ ‡è®°
   - è°ƒæ•´æ—¥å¿—çº§åˆ«
   - æ¶ˆé™¤é­”æ³•æ•°å­—

2. **æ–‡æ¡£å®Œå–„**
   - ä¸ºå¤æ‚å‡½æ•°æ·»åŠ è¯¦ç»†æ³¨é‡Š
   - è®°å½•è®¾è®¡å†³ç­–

---

## ğŸ” å®¡æŸ¥æ–¹æ³•è®º

æœ¬æ¬¡å®¡æŸ¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·å’Œæ–¹æ³•ï¼š

1. **é™æ€åˆ†æ**
   - `ruff check . --select C901` (å¤æ‚åº¦)
   - `grep` æœç´¢å¼‚å¸¸å¤„ç†æ¨¡å¼
   - `grep` æœç´¢æ–‡ä»¶æ“ä½œæ¨¡å¼

2. **ä»£ç æ¨¡å¼è¯†åˆ«**
   - å¼‚å¸¸å¤„ç†åæ¨¡å¼
   - èµ„æºç®¡ç†é—®é¢˜
   - é“¾å¼è°ƒç”¨é£é™©

3. **ä¼˜å…ˆçº§è¯„ä¼°**
   - P0: è¿è¡Œæ—¶é£é™©ã€èµ„æºæ³„æ¼
   - P1: å¯ç»´æŠ¤æ€§ã€è®¾è®¡é—®é¢˜
   - P2: ä»£ç è´¨é‡ã€æœ€ä½³å®è·µ

---

## âœ… ç»“è®º

é¡¹ç›®æ•´ä½“ä»£ç è´¨é‡è‰¯å¥½ï¼ŒP0 å…³é”®é—®é¢˜å·²å…¨éƒ¨ä¿®å¤ï¼š

1. **å¼‚å¸¸å¤„ç†è¿‡äºå®½æ³›** - âœ… å·²ä¿®å¤ï¼ˆå…³é”®æ¨¡å—å·²å®Œæˆï¼‰
2. **ä»£ç å¤æ‚åº¦åé«˜** - ğŸ“‹ å¾…ä¼˜åŒ–ï¼ˆP1 çº§åˆ«ï¼‰
3. **èµ„æºç®¡ç†ä¸å®Œå–„** - âœ… å·²ä¿®å¤

**ä¿®å¤æˆæœ** (2026-02-03):
- âœ… æ–‡ä»¶èµ„æºæ³„æ¼ï¼š1 â†’ 0
- âœ… ç½‘ç»œè¶…æ—¶ç¼ºå¤±ï¼š6 â†’ 0  
- âœ… å¼‚å¸¸å¤„ç†ï¼š19 â†’ 6ï¼ˆå…³é”®æ¨¡å—å·²å®Œæˆï¼‰
- âœ… æ‰€æœ‰ P0 é—®é¢˜å·²è§£å†³

**æµ‹è¯•çŠ¶æ€**: 103/103 é€šè¿‡ (100%)  
**ä»£ç è§„æ¨¡**: 12,817 è¡Œ  
**ä¸‹ä¸€æ­¥**: ä¼˜åŒ– P1 çº§åˆ«é—®é¢˜ï¼ˆä»£ç å¤æ‚åº¦ã€å¼‚å¸¸ä½“ç³»ç»Ÿä¸€ï¼‰